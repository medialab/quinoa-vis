"use strict";function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.computeDataRelatedState=exports.computeBoundaries=exports.computeEvents=exports.computePeriods=exports.clusterEvents=exports.computeTicks=exports.setTicks=exports.computeDate=void 0;var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},_d3Time=require("d3-time"),_d3Array=require("d3-array"),_d3Scale=require("d3-scale"),_d3TimeFormat=require("d3-time-format"),SECOND=1e3,MINUTE=60*SECOND,HOUR=60*MINUTE,DAY=24*HOUR,MONTH=31*DAY,YEAR=365*DAY,computeDate=exports.computeDate=function(e,t,i,n){if(0===e||e){var r=new Date;if(r.setFullYear(e),t?r.setMonth(t-1):r.setMonth(0),i?r.setDate(i):r.setDate(1),n&&"string"==typeof n){var a=n.split(":");a.length>0&&+a[0]>=0&&+a[0]<24?r.setHours(a.shift()):(r.setHours(0),r.setMinutes(0),r.setSeconds(0)),a.length>0&&+a[0]>=0&&+a[0]<60?r.setMinutes(a.shift()):(r.setMinutes(0),r.setSeconds(0)),a.length>0&&+a[0]>=0&&+a[0]<60?r.setSeconds(a.shift()):r.setSeconds(0)}else r.setHours(0),r.setMinutes(0),r.setSeconds(0);return r}},setTicks=exports.setTicks=function(e){var t=void 0,i=void 0,n=void 0;return e>1e3*YEAR?(t=_d3Time.timeYear,i=500,n="%Y"):e>500*YEAR?(t=_d3Time.timeYear,i=250,n="%Y"):e>250*YEAR?(t=_d3Time.timeYear,i=125,n="%Y"):e>100*YEAR?(t=_d3Time.timeYear,i=50,n="%Y"):e>10*YEAR?(t=_d3Time.timeYear,i=10,n="%Y"):e>3*YEAR?(t=_d3Time.timeYear,i=1,n="%Y"):e>YEAR?(t=_d3Time.timeMonth,i=6,n="%m/%Y"):e>6*MONTH?(t=_d3Time.timeMonth,i=1,n="%m/%Y"):e>MONTH?(t=_d3Time.timeDay,i=15,n="%m/%d/%Y"):e>15*DAY?(t=_d3Time.timeDay,i=3,n="%m/%d/%Y"):e>DAY?(t=_d3Time.timeDay,i=1,n="%m/%d/%Y"):e>6*HOUR?(t=_d3Time.timeHour,i=1,n="%m/%d/%Y, %I %p"):e>HOUR?(t=_d3Time.timeMinute,i=30,n="%H:%M"):e>30*MINUTE?(t=_d3Time.timeMinute,i=10,n="%H:%M"):e>10*MINUTE?(t=_d3Time.timeMinute,i=5,n="%H:%M"):e>MINUTE?(t=_d3Time.timeMinute,i=1,n="%H:%M"):(t=_d3Time.timeSecond,i=30,n="%H:%M:%S"),{unit:t,span:i,format:n}},computeTicks=exports.computeTicks=function(e,t){var i=setTicks(t-e),n=(0,_d3TimeFormat.timeFormat)(i.format),r=new Date;r.setFullYear(-1e5),r.setDate(1),r.setHours(0),r.setMinutes(0),r.setSeconds(0),r.setMilliseconds(0);var a=i.unit.range(r,t,i.span);return a.filter(function(t){return t.getTime()>=e}).map(function(e){return{time:e.getTime(),legend:n(e)}})},clusterEvents=exports.clusterEvents=function(e,t){return e.reduce(function(e,i){var n=void 0;return e.timeObjects.length&&(n=e.timeObjects[e.timeObjects.length-1]),n&&i.startDate.getTime()-n.startDate.getTime()<t?(i.column=n.column+1,n.overlapped=!0,i.overlapped=!1,e.columns[e.columns.length-1]<i.column&&e.columns.push(i.column)):i.column=1,e.timeObjects.push(i),e},{timeObjects:[],columns:[1]})},computePeriods=exports.computePeriods=function(e){var t=1,i=e.filter(function(e){return void 0!==e.endDate});i.forEach(function(e,n){var r=void 0;n>0&&(r=i[n-1]),r&&e.startDate<r.endDate?(e.column=r.column+1,r.overlapped=!0,e.overlapped=!1,r.column+1>t&&(t=r.column+1)):e.column=1});for(var n=[],r=0;r<t;r++)n.push(r+1);return{columns:n,timeObjects:i}},computeEvents=exports.computeEvents=function(e,t){var i=1,n=e.filter(function(e){return void 0===e.endDate}).map(function(e){return Object.assign({},e)});n.forEach(function(e,r){var a=void 0;r>0&&(a=n[r-1]),a&&e.startDate-a.startDate<=t?(e.column=a.column+1,a.column+1>i&&(i=a.column+1)):e.column=1});for(var r=[],a=0;a<i;a++)r.push(a+1);return{columns:r,timeObjects:n}},computeBoundaries=exports.computeBoundaries=function(e){var t=(0,_d3Array.min)(e,function(e){return e.startDate.getTime()}),i=(0,_d3Array.max)(e,function(e){return e.endDate?e.endDate.getTime():e.startDate.getTime()}),n=i-t,r=n/100,a=t-r,m=i+r;return{minimumDate:t,maximumDate:i,minimumDateDisplay:a,maximumDateDisplay:m}},mapData=function(e,t){return e.map(function(e){return Object.keys(t).reduce(function(i,n){return _extends({},i,_defineProperty({},n,"function"==typeof t[n]?t[n](e):e[t[n]]))},{})}).map(function(e){var t=e.year,i=e.month,n=e.day,r=e.time,a=e.endYear,m=e.endMonth,o=e.endDay,s=e.endTime,u=computeDate(t,i,n,r),c=computeDate(a,m,o,s);return _extends({},e,{startDate:u,endDate:c})}).sort(function(e,t){return e.startDate.getTime()>t.startDate.getTime()?1:-1})},computeDataRelatedState=exports.computeDataRelatedState=function(e,t,i){var n=mapData(e,t),r=computeBoundaries(n),a=computeTicks(r.minimumDateDisplay,r.maximumDateDisplay),m=(r.maximumDateDisplay-r.minimumDateDisplay)/1e3;return{timeBoundaries:r,miniTicks:a,data:n,viewParameters:i,miniScale:(0,_d3Scale.scaleLinear)().range([0,100]).domain([r.minimumDateDisplay,r.maximumDateDisplay]),periodsClusters:computePeriods(n),eventsClusters:computeEvents(n,m)}};